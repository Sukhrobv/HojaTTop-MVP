import React, { createContext, useContext, useEffect, useMemo, useState } from 'react'
import AsyncStorage from '@react-native-async-storage/async-storage'

type Language = 'ru' | 'uz'

type TranslationDict = Record<string, string>
type Translations = Record<Language, TranslationDict>

const STORAGE_KEY = 'appLanguage'

const translations: Translations = {
  ru: {
    'settings.language': 'Язык интерфейса',
    'settings.language.ru': 'RU',
    'settings.language.uz': 'UZ',
    'settings.section.profile': 'Профиль',
    'settings.login': 'Войти в профиль',
    'settings.login.subtitle': 'Чтобы оставлять отзывы и влиять на рейтинг',
    'settings.logout.success': 'Вы вышли из аккаунта',
    'settings.logout.title': 'Выход',
    'settings.logout.confirm': 'Выйти из аккаунта?',
    'settings.logout.cancel': 'Отмена',
    'settings.logout.submit': 'Выйти',
    'settings.anonymous.title': 'Анонимный режим',
    'settings.anonymous.on': 'Имя скрыто в отзывах',
    'settings.anonymous.off': 'Имя видно другим',
    'settings.section.community': 'Сообщество и развитие',
    'settings.addPoint.title': 'Добавить точку',
    'settings.addPoint.subtitle': 'Знаете предпринимателя или хорошее место? Напишите нам',
    'settings.moderator.title': 'Стать модератором',
    'settings.moderator.subtitle': 'Помогайте проверять данные и фотографии',
    'settings.community.info': 'Пока точки добавляет админ. Напишите в Telegram — добавим быстро.',
    'settings.section.app': 'Приложение',
    'settings.appearance': 'Внешний вид',
    'settings.appearance.subtitle': 'Светлая тема',
    'settings.notifications': 'Уведомления',
    'settings.notifications.subtitle': 'Отключены',
    'settings.manifest.title':
      'HojaTTop — это не просто карта. Мы строим культуру уважения к человеческому достоинству.',
    'settings.manifest.body':
      'Делитесь честными точками и отзывами, помогайте людям заранее понимать условия и чувствовать себя в безопасности. Каждая точка — это забота о достоинстве и комфорте.',
    'settings.manifest.version': 'Версия: 1.0.0 (Beta)',
    'settings.account.active': 'Аккаунт активен',
    'settings.reviews': 'отзывов',
    // --- SCREEN TITLES ---
    'screen.details': 'Детали',
    'screen.addReview': 'Добавить отзыв',
    'screen.filters': 'Фильтры',
    'screen.settings': 'Настройки',
    'screen.auth': 'Вход / Регистрация',
    // --- STAR SLIDER ---
    'rating.slider.helper': 'Нажмите или проведите пальцем по звездочкам',
    // --- REVIEW COMPONENTS ---
    'components.reward.defaultTitle': 'Спасибо за отзыв!',
    'components.reward.defaultLabel': 'Ваш бонус',
    'components.reward.placeholder': 'Покажите экран сотруднику',
    'components.reward.close': 'Закрыть',
    'components.date.today': 'Сегодня',
    'components.date.yesterday': 'Вчера',
    'components.date.daysAgo': '{days} дн. назад',
    'components.review.anonymous': 'Аноним',
    'components.review.hide': 'Скрыть',
    'components.review.readMore': 'Читать далее',
    'components.section.reviews': 'Отзывы',
    'components.button.loading': 'Загрузка...',
    'components.button.refresh': 'Обновить',
    'components.list.loading': 'Загрузка отзывов...',
    'components.list.empty': 'Отзывов пока нет',
    'components.list.beFirst': 'Станьте первым, кто оставит отзыв!',
    // --- RATING SELECTOR ---
    'rating.label.1': 'Ужасно',
    'rating.label.2': 'Плохо',
    'rating.label.3': 'Нормально',
    'rating.label.4': 'Хорошо',
    'rating.label.5': 'Отлично',
    'rating.placeholder': 'Оцените туалет',
    // --- DATA BANNER ---
    'banner.time.justNow': 'только что',
    'banner.time.minAgo': '{min} мин назад',
    'banner.time.hourAgo': '{hour} ч назад',
    'banner.time.dayAgo': '{day} дн назад',
    'banner.status.offline': 'Офлайн данные',
    'banner.status.cached': 'Кэшированные данные',
    'banner.status.noData': 'Нет данных',
    'banner.status.online': 'Онлайн',
    'banner.count': '{count} туалетов',
    'banner.btn.updating': 'Обновление...',
    'banner.btn.update': 'Обновить',
    // ToiletDetail screen
    'toilet.loading': 'Загрузка...',
    'toilet.notFound': 'Туалет не найден',
    'toilet.loadError': 'Ошибка загрузки данных',
    'toilet.alert.errorTitle': 'Ошибка',
    'toilet.alert.mapsFail': 'Не удалось открыть карты',
    'toilet.payment.free': 'Бесплатно',
    'toilet.payment.paid': 'Платно',
    'toilet.buttons.route': 'Маршрут',
    'toilet.buttons.review': 'Отзыв',
    'toilet.buttons.back': 'Назад',
    'toilet.reviews.empty': 'Отзывов о данном туалете пока нет',
    'toilet.reward.title': 'Спасибо за отзыв!',
    'toilet.reward.label': 'Ваш бонус',
    // Filters screen
    'filters.header.search': 'Что ищем?',
    'filters.header.rating': 'Минимальный рейтинг',
    'filters.header.distance': 'Расстояние',
    'filters.card.accessibility': 'Для инвалидов',
    'filters.card.baby': 'С детьми',
    'filters.card.ablution': 'Омовение',
    'filters.card.free': 'Бесплатно',
    'filters.rating.none': 'Не важно',
    'filters.rating.left': 'Любой',
    'filters.rating.right': 'Только 5.0',
    'filters.distance.value': 'до {km} км',
    'filters.distance.all': 'Весь город',
    'filters.distance.left': 'Рядом',
    'filters.distance.right': '∞ Не ограничено',
    'filters.buttons.reset': 'Сброс',
    'filters.buttons.show': 'Показать',
    // Auth screen
    'auth.already': 'Вы уже авторизованы!',
    'auth.back': 'Вернуться назад',
    'auth.login.missingUser': 'Введите имя пользователя',
    'auth.login.missingPass': 'Введите пароль',
    'auth.login.success.title': 'С возвращением!',
    'auth.login.success.body': 'Рады видеть вас снова, {name}!',
    'auth.login.error.title': 'Ошибка входа',
    'auth.login.error.body': 'Неверное имя пользователя или пароль',
    'auth.login.error.generic': 'Произошла ошибка при входе',
    'auth.register.userShort': 'Имя пользователя должно содержать минимум 2 символа',
    'auth.register.passShort': 'Пароль должен содержать минимум 6 символов',
    'auth.register.emailInvalid': 'Введите корректный email',
    'auth.register.success.title': 'Добро пожаловать!',
    'auth.register.success.body': 'Регистрация прошла успешно, {name}!',
    'auth.register.error.title': 'Ошибка регистрации',
    'auth.register.error.body': 'Неизвестная ошибка',
    'auth.register.error.generic': 'Произошла ошибка при регистрации',
    'auth.choose.title': 'Добро пожаловать!',
    'auth.choose.subtitle': 'Выберите действие для продолжения',
    'auth.choose.login': 'Войти в аккаунт',
    'auth.choose.register': 'Создать профиль',
    'auth.choose.skip': 'Пропустить (остаться анонимным)',
    'auth.choose.why.title': 'Зачем нужна регистрация?',
    'auth.choose.why.item1': 'Ваши отзывы будут подписаны вашим именем',
    'auth.choose.why.item2': 'Неограниченное количество отзывов',
    'auth.choose.why.item3': 'Возможность переключиться в анонимный режим',
    'auth.form.loginTitle': 'Вход в аккаунт',
    'auth.form.registerTitle': 'Создание профиля',
    'auth.form.loginSubtitle': 'Введите данные для входа',
    'auth.form.registerSubtitle': 'Создайте профиль для добавления отзывов',
    'auth.field.username': 'Имя пользователя *',
    'auth.field.username.placeholder.login': 'Ваше имя',
    'auth.field.username.placeholder.register': 'Введите ваше имя',
    'auth.field.username.hint.login': 'Введите имя, которое использовали при регистрации',
    'auth.field.username.hint.register': 'Это имя будет отображаться в ваших отзывах',
    'auth.field.password': 'Пароль *',
    'auth.field.password.placeholder': 'Введите пароль',
    'auth.field.password.hint': 'Минимум 6 символов',
    'auth.field.email.toggle.show': 'Добавить email (необязательно)',
    'auth.field.email.toggle.hide': 'Скрыть email',
    'auth.field.email.hint': 'Email нужен только для восстановления аккаунта',
    'auth.submit.login': 'Вход...',
    'auth.submit.register': 'Создание...',
    'auth.submit.login.cta': 'Войти',
    'auth.submit.register.cta': 'Создать профиль',
    'auth.switch.noAccount': 'Нет аккаунта?',
    'auth.switch.haveAccount': 'Уже есть аккаунт?',
    'auth.switch.toRegister': 'Создать аккаунт',
    'auth.switch.toLogin': 'Войти в существующий',
    'auth.backToChoose': '← Назад к выбору',
    // --- MAP SCREEN ---
    'map.search.placeholder': 'Поиск...',
    'map.loading': 'Загрузка туалетов...',
    'map.error.retry': 'Попробовать снова',
    'map.status.found': 'Найдено: {count} точек',
    'map.status.offline': 'Офлайн данные',
    // AddReview screen
    'addReview.reward.title': 'Спасибо за отзыв!',
    'addReview.reward.subtitle': 'Мы начислили примерный бонус за этот отзыв.',
    'addReview.reward.label': 'Ваш бонус',
    'addReview.reward.terms': 'Покажите этот код сотруднику в течение 7 дней. Это демонстрация награды.',
    'addReview.auth.requiredTitle': 'Требуется регистрация',
    'addReview.auth.requiredMessage': 'Для добавления отзывов необходимо зарегистрироваться в приложении',
    'addReview.auth.cancel': 'Отмена',
    'addReview.auth.register': 'Зарегистрироваться',
    'addReview.auth.error': 'Ошибка',
    'addReview.auth.noRating': 'Пожалуйста, поставьте оценку',
    'addReview.auth.commentTooLong': 'Комментарий не должен превышать 500 символов',
    'addReview.auth.addFailed': 'Не удалось добавить отзыв. Проверьте интернет и попробуйте снова.',
    'addReview.auth.submitFailed': 'Произошла ошибка при отправке отзыва',
    'addReview.stub.header': 'Нужна регистрация',
    'addReview.stub.whyTitle': 'Почему нужна регистрация?',
    'addReview.stub.reason1': 'Отзывы будут подписаны вашим именем',
    'addReview.stub.reason2': 'Защита от спама и фальшивых отзывов',
    'addReview.stub.reason3': 'Возможность редактировать свои отзывы',
    'addReview.stub.back': 'Вернуться назад',
    'addReview.header.publishedAs': 'Отзыв будет опубликован от имени:',
    'addReview.header.anonymous': 'Вы в анонимном режиме',
    'addReview.header.hint': 'Можно переключиться в анонимный режим в настройках',
    'addReview.rating.title': 'Оценка точки',
    'addReview.features.title': 'Удобства',
    'addReview.access.title': 'Доступность',
    'addReview.access.paid': 'Платный',
    'addReview.access.free': 'Бесплатный',
    'addReview.comment.label': 'Комментарий (необязательно)',
    'addReview.comment.placeholder': 'Поделитесь вашим опытом...',
    'addReview.submit.send': 'Отправить отзыв',
    'addReview.submit.submitting': 'Отправка...',
    'addReview.help.rating.title': 'Что важно при оценке?',
    'addReview.help.rating.hook.title': '«Тест на крючок»',
    'addReview.help.rating.hook.body': 'Есть ли крючок/полка для сумки или куртки?',
    'addReview.help.rating.hygiene.title': 'Гигиена и вода',
    'addReview.help.rating.hygiene.body': 'Есть ли вода, мыло и условия для омовения?',
    'addReview.help.rating.clean.title': 'Чистота и запах',
    'addReview.help.rating.clean.body': 'Чистый пол, сантехника, нет резкого запаха.',
    'addReview.help.rating.privacy.title': 'Приватность',
    'addReview.help.rating.privacy.body': 'Исправен ли замок? Чувствуете безопасность?',
    'addReview.help.rating.guideTitle': 'Шпаргалка по звёздам',
    'addReview.help.rating.star1.title': '1 — Критично.',
    'addReview.help.rating.star1.body': 'Грязно, сломано, страшно зайти.',
    'addReview.help.rating.star3.title': '3 — База.',
    'addReview.help.rating.star3.body': 'Чисто, но не хватает мыла/крючка/бумаги.',
    'addReview.help.rating.star5.title': '5 — Идеал.',
    'addReview.help.rating.star5.body': 'Чисто, есть крючок, мыло, вода — комфортно.',
    'addReview.help.features.title': 'Что считается удобством?',
    'addReview.help.features.intro': 'Отмечайте только то, что реально работает и доступно посетителям.',
    'addReview.help.features.access.title': 'Доступная среда',
    'addReview.help.features.access.body':
      'Пандус (не крутой), широкие двери, поручни. Реальная возможность заехать на коляске.',
    'addReview.help.features.baby.title': 'Родителям и малышам',
    'addReview.help.features.baby.body':
      'Пеленальный столик или чистая поверхность, где можно безопасно переодеть ребенка.',
    'addReview.help.features.ablution.title': 'Условия для омовения',
    'addReview.help.features.ablution.body':
      'Кувшин (обдаста), низкий кран или шланг, а также сухая зона для подготовки.',
    'addReview.help.features.footer.title': 'Ваша помощь:',
    'addReview.help.features.footer.body':
      'честно отмечая эти пункты, вы помогаете людям заранее спланировать маршрут и избежать стресса.',
  },
  uz: {
    'settings.language': 'Interfeys tili',
    'settings.language.ru': 'RU',
    'settings.language.uz': 'UZ',
    'settings.section.profile': 'Profilim',
    'settings.login': 'Profilga kirish',
    'settings.login.subtitle': 'Sharh qoldirish va reytingga taʼsir qilish uchun',
    'settings.logout.success': 'Siz akkauntdan chiqdingiz',
    'settings.logout.title': 'Chiqish',
    'settings.logout.confirm': 'Ishonchingiz komilmi?',
    'settings.logout.cancel': 'Bekor qilish',
    'settings.logout.submit': 'Chiqish',
    'settings.anonymous.title': 'Anonim rejim',
    'settings.anonymous.on': 'Ismingiz sharhlarda yashiriladi',
    'settings.anonymous.off': 'Ismingiz ko‘rsatiladi',
    'settings.section.community': 'Jamiyat va rivoj',
    'settings.addPoint.title': 'Nuqta qo‘shish',
    'settings.addPoint.subtitle': 'Tadbirkor yoki yaxshi joyni bilasizmi?',
    'settings.moderator.title': 'Moderator bo‘lish',
    'settings.moderator.subtitle': 'Maʼlumot va fotosuratlarni tekshirishga yordam bering.',
    'settings.community.info': 'Hozircha nuqtalarni admin qo‘shadi. Telegramda yozing — tez kiritamiz!',
    'settings.section.app': 'Ilova',
    'settings.appearance': 'Ko‘rinish',
    'settings.appearance.subtitle': 'Yorug‘ tema',
    'settings.notifications': 'Bildirishnomalar',
    'settings.notifications.subtitle': 'O‘chirilgan',
    'settings.manifest.title': 'HojaTTop — oddiy xarita emas. Biz inson qadr-qimmatiga hurmat madaniyatini quramiz.',
    'settings.manifest.body':
      'Halol nuqtalar va sharhlar bilan o‘rtoqlashing, odamlar sharoitni oldindan bilib, o‘zini xavfsiz his qilishiga yordam bering. Har bir nuqta — bu qulaylik va qadriyat haqida g‘amxo‘rlik.',
    'settings.manifest.version': 'Versiya: 1.0.0 (Beta)',
    'settings.account.active': 'Profil faol',
    'settings.reviews': 'ta sharh',
    // --- SCREEN TITLES ---
    'screen.details': 'Tafsilotlar',
    'screen.addReview': 'Sharh qoldirish',
    'screen.filters': 'Filtrlar',
    'screen.settings': 'Sozlamalar',
    'screen.auth': 'Kirish / Ro‘yxatdan o‘tish',
    // --- STAR SLIDER ---
    'rating.slider.helper': 'Yulduzchalarni bosing yoki barmoq bilan suring',
    // --- REVIEW COMPONENTS ---
    'components.reward.defaultTitle': 'Sharhingiz uchun rahmat!',
    'components.reward.defaultLabel': 'Sizning bonusingiz',
    'components.reward.placeholder': 'Ekranni xodimga ko‘rsating',
    'components.reward.close': 'Yopish',
    'components.date.today': 'Bugun',
    'components.date.yesterday': 'Kecha',
    'components.date.daysAgo': '{days} kun oldin',
    'components.review.anonymous': 'Anonim',
    'components.review.hide': 'Yashirish',
    'components.review.readMore': 'Batafsil',
    'components.section.reviews': 'Sharhlar',
    'components.button.loading': 'Yuklanmoqda...',
    'components.button.refresh': 'Yangilash',
    'components.list.loading': 'Sharhlar yuklanmoqda...',
    'components.list.empty': 'Hozircha sharhlar yo‘q',
    'components.list.beFirst': 'Birinchi bo‘lib sharh qoldiring!',
    // --- RATING SELECTOR ---
    'rating.label.1': 'Juda yomon',
    'rating.label.2': 'Yomon',
    'rating.label.3': 'O‘rtacha',
    'rating.label.4': 'Yaxshi',
    'rating.label.5': 'A’lo',
    'rating.placeholder': 'Hojatxonani baholang',
    // --- DATA BANNER ---
    'banner.time.justNow': 'hozirgina',
    'banner.time.minAgo': '{min} daq oldin',
    'banner.time.hourAgo': '{hour} soat oldin',
    'banner.time.dayAgo': '{day} kun oldin',
    'banner.status.offline': 'Oflayn ma’lumotlar',
    'banner.status.cached': 'Keshdagi ma’lumotlar',
    'banner.status.noData': 'Ma’lumot yo‘q',
    'banner.status.online': 'Onlayn',
    'banner.count': '{count} ta hojatxona',
    'banner.btn.updating': 'Yangilanmoqda...',
    'banner.btn.update': 'Yangilash',
    // ToiletDetail screen
    'toilet.loading': 'Yuklanmoqda...',
    'toilet.notFound': 'Hojatxona topilmadi',
    'toilet.loadError': 'Ma’lumotlarni yuklashda xatolik',
    'toilet.alert.errorTitle': 'Xatolik',
    'toilet.alert.mapsFail': 'Xaritani ochib bo‘lmadi',
    'toilet.payment.free': 'Bepul',
    'toilet.payment.paid': 'Pullik',
    'toilet.buttons.route': 'Yo‘nalish',
    'toilet.buttons.review': 'Sharh',
    'toilet.buttons.back': 'Ortga',
    'toilet.reviews.empty': 'Ushbu hojatxona haqida hali sharhlar yo‘q',
    'toilet.reward.title': 'Sharhingiz uchun rahmat!',
    'toilet.reward.label': 'Sizning bonusingiz',
    // Filters screen
    'filters.header.search': 'Qidiruv',
    'filters.header.rating': 'Minimal reyting',
    'filters.header.distance': 'Masofa',
    'filters.card.accessibility': 'Imkoniyati cheklangan',
    'filters.card.baby': 'Bolalar bilan',
    'filters.card.ablution': 'Tahorat',
    'filters.card.free': 'Bepul',
    'filters.rating.none': 'Muhim emas',
    'filters.rating.left': 'Har qanday',
    'filters.rating.right': 'Faqat 5.0',
    'filters.distance.value': '{km} km gacha',
    'filters.distance.all': 'Butun shahar',
    'filters.distance.left': 'Yaqin atrofda',
    'filters.distance.right': '∞ Cheklovsiz',
    'filters.buttons.reset': 'Tozalash',
    'filters.buttons.show': 'Ko‘rsatish',
    // Auth screen
    'auth.already': 'Siz allaqachon tizimga kirgansiz!',
    'auth.back': 'Ortga qaytish',
    'auth.login.missingUser': 'Foydalanuvchi nomini kiriting',
    'auth.login.missingPass': 'Parolni kiriting',
    'auth.login.success.title': 'Xush kelibsiz!',
    'auth.login.success.body': 'Sizni yana ko‘rib turganimizdan xursandmiz, {name}!',
    'auth.login.error.title': 'Kirishda xatolik',
    'auth.login.error.body': 'Foydalanuvchi nomi yoki parol noto‘g‘ri',
    'auth.login.error.generic': 'Tizimga kirishda xatolik yuz berdi',
    'auth.register.userShort': 'Foydalanuvchi nomi kamida 2 ta belgidan iborat bo‘lishi kerak',
    'auth.register.passShort': 'Parol kamida 6 ta belgidan iborat bo‘lishi kerak',
    'auth.register.emailInvalid': 'To‘g‘ri email kiriting',
    'auth.register.success.title': 'Xush kelibsiz!',
    'auth.register.success.body': 'Muvaffaqiyatli ro‘yxatdan o‘tdingiz, {name}!',
    'auth.register.error.title': 'Ro‘yxatdan o‘tishda xatolik',
    'auth.register.error.body': 'Noma’lum xatolik',
    'auth.register.error.generic': 'Ro‘yxatdan o‘tishda xатolik yuz berdi',
    'auth.choose.title': 'Xush kelibsiz!',
    'auth.choose.subtitle': 'Davom etish uchun tanlang',
    'auth.choose.login': 'Tizimga kirish',
    'auth.choose.register': 'Profil yaratish',
    'auth.choose.skip': 'O‘tkazib yuborish (anonim qolish)',
    'auth.choose.why.title': 'Nima uchun ro‘yxatdan o‘tish kerak?',
    'auth.choose.why.item1': 'Sharhlar sizning nomingizdan yoziladi',
    'auth.choose.why.item2': 'Cheklovsiz sharhlar qoldirish imkoniyati',
    'auth.choose.why.item3': 'Anonim rejimga o‘tish imkoniyati',
    'auth.form.loginTitle': 'Tizimga kirish',
    'auth.form.registerTitle': 'Profil yaratish',
    'auth.form.loginSubtitle': 'Kirish ma’lumotlarini kiriting',
    'auth.form.registerSubtitle': 'Sharh qoldirish uchun profil yarating',
    'auth.field.username': 'Foydalanuvchi nomi *',
    'auth.field.username.placeholder.login': 'Ismingiz',
    'auth.field.username.placeholder.register': 'Ismingizni kiriting',
    'auth.field.username.hint.login': 'Ro‘yxatdan o‘tishda ishlatgan nomingizni kiriting',
    'auth.field.username.hint.register': 'Bu nom sharhlaringizda ko‘rinadi',
    'auth.field.password': 'Parol *',
    'auth.field.password.placeholder': 'Parolni kiriting',
    'auth.field.password.hint': 'Kamida 6 ta belgi',
    'auth.field.email.toggle.show': 'Email qo‘shish (ixtiyoriy)',
    'auth.field.email.toggle.hide': 'Emailni yashirish',
    'auth.field.email.hint': 'Email faqat akkauntni tiklash uchun kerak',
    'auth.submit.login': 'Kirilmoqda...',
    'auth.submit.register': 'Yaratilmoqda...',
    'auth.submit.login.cta': 'Kirish',
    'auth.submit.register.cta': 'Profil yaratish',
    'auth.switch.noAccount': 'Akkauntingiz yo‘qmi?',
    'auth.switch.haveAccount': 'Akkauntingiz bormi?',
    'auth.switch.toRegister': 'Akkaunt yaratish',
    'auth.switch.toLogin': 'Tizimga kirish',
    'auth.backToChoose': '← Tanlovga qaytish',

    // --- MAP SCREEN ---
    'map.search.placeholder': 'Qidirish...',
    'map.loading': 'Hojatxonalar yuklanmoqda...',
    'map.error.retry': 'Qayta urinib ko‘rish',
    'map.status.found': 'Topildi: {count} ta joy',
    'map.status.offline': 'Oflayn ma’lumotlar',
    
    // AddReview screen
    'addReview.reward.title': 'Sharhingiz uchun rahmat!',
    'addReview.reward.subtitle': 'Ushbu sharh uchun sizga taxminiy bonus taqdim etildi.',
    'addReview.reward.label': 'Sizning bonusingiz',
    'addReview.reward.terms': 'Ushbu kodni 7 kun ichida xodimga ko‘rsating. Bu mukofот namoyishi.',
    'addReview.auth.requiredTitle': 'Ro‘yxatdan o‘tish kerak',
    'addReview.auth.requiredMessage': 'Sharh qoldirish uchun ilovada ro‘yxatdan o‘tish lozim',
    'addReview.auth.cancel': 'Bekor qilish',
    'addReview.auth.register': 'Ro‘yxatdan o‘tish',
    'addReview.auth.error': 'Xatolik',
    'addReview.auth.noRating': 'Iltimos, baho qo‘ying',
    'addReview.auth.commentTooLong': 'Izoh 500 belgidan oshmasligi kerak',
    'addReview.auth.addFailed': 'Sharh qo‘shib bo‘lmadi. Internetni tekshiring va qayta urinib ko‘ring.',
    'addReview.auth.submitFailed': 'Sharhni yuborishda xatolik yuz berdi',
    'addReview.stub.header': 'Ro‘yxatdan o‘tish kerak',
    'addReview.stub.whyTitle': 'Nima uchun ro‘yxatdan o‘tish kerak?',
    'addReview.stub.reason1': 'Sharhlar sizning nomingizdan yoziladi',
    'addReview.stub.reason2': 'Spam va soxta sharhlardan himoya',
    'addReview.stub.reason3': 'O‘z sharhlaringizni tahrirlash imkoniyati',
    'addReview.stub.back': 'Orqaga qaytish',
    'addReview.header.publishedAs': 'Sharh quyidagi nomдан chop etiladi:',
    'addReview.header.anonymous': 'Siz anonim rejimasiz',
    'addReview.header.hint': 'Sozlamalarda anonim rejimga o‘tish mumkin',
    'addReview.rating.title': 'Joyni baholash',
    'addReview.features.title': 'Qulayliklar',
    'addReview.access.title': 'Kirish shartlari',
    'addReview.access.paid': 'Pullik',
    'addReview.access.free': 'Bepul',
    'addReview.comment.label': 'Izoh (ixtiyoriy)',
    'addReview.comment.placeholder': 'Tajribangiz bilan bo‘lishing: nima yoqdi, nimani yaxshilash kerak...',
    'addReview.submit.send': 'Sharhni yuborish',
    'addReview.submit.submitting': 'Yuborilmoqda...',
    'addReview.help.rating.title': 'Baholashda nima muhim?',
    'addReview.help.rating.hook.title': '«Ilgak testi»',
    'addReview.help.rating.hook.body': 'Sumka yoki kurtка uchun ilgak/tokча bormi?',
    'addReview.help.rating.hygiene.title': 'Gigiena va suv',
    'addReview.help.rating.hygiene.body': 'Suv, sovun va tahorat uchun sharoит bormi?',
    'addReview.help.rating.clean.title': 'Tozalik va hid',
    'addReview.help.rating.clean.body': 'Pol toza, santexnika soz, o‘tkir hid yo‘q.',
    'addReview.help.rating.privacy.title': 'Maxfiylik va xavfsizlik',
    'addReview.help.rating.privacy.body': 'Eshik qulfi ishlaydimi? O‘zingizni xavfsiz his qilyapsizmi?',
    'addReview.help.rating.guideTitle': 'Yulduzlar bo‘yicha qo‘llanma',
    'addReview.help.rating.star1.title': '1 — Juda yomon.',
    'addReview.help.rating.star1.body': 'Kir, siniq, kirishga qo‘rqinchli.',
    'addReview.help.rating.star3.title': '3 — O‘rtacha.',
    'addReview.help.rating.star3.body': 'Toza, lekin sovun/ilgak/qog‘oz yetishmaydi.',
    'addReview.help.rating.star5.title': '5 — A’lo.',
    'addReview.help.rating.star5.body': 'Toza, ilgak, sovun, suv bor — qulay.',
    'addReview.help.features.title': 'Nimalar qulaylik hisobланadi?',
    'addReview.help.features.intro':
      'Faqat haqiqatan ishlaydigan va tashrif buyuruvchilar uchun mavjud bo‘lgan narsalarni belgilang.',
    'addReview.help.features.access.title': 'Imkoniyati cheklanganlar uchun',
    'addReview.help.features.access.body':
      'Pandus (tik emas), keng eshiklar, tutqichlar. Aravachada kirish imkoniyati mavjud.',
    'addReview.help.features.baby.title': 'Ota-onalar va bolalar uchun',
    'addReview.help.features.baby.body': 'Taglik almashtirish stoli yoki bola parvarishi uchun toza joy.',
    'addReview.help.features.ablution.title': 'Tahorat uchun sharoit',
    'addReview.help.features.ablution.body':
      'Obdasta, past kran/shlang, tayyorgarlik uchun quruq joy. Tahoratga mos.',
    'addReview.help.features.footer.title': 'Sizning yordamingiz:',
    'addReview.help.features.footer.body':
      'ushbu bandlarni halol belgilash orqali siz odamlarga yo‘nalishni oldindan rejalashtirish va ovoragarchilikning oldini olishga yordam berasiz.',
  },
}

type LanguageContextValue = {
  language: Language
  setLanguage: (lang: Language) => void
  t: (key: string, fallback?: string) => string
}

const LanguageContext = createContext<LanguageContextValue | undefined>(undefined)

export const LanguageProvider = ({ children }: { children: React.ReactNode }) => {
  const [language, setLanguageState] = useState<Language>('ru')

  useEffect(() => {
    AsyncStorage.getItem(STORAGE_KEY).then((stored) => {
      if (stored === 'ru' || stored === 'uz') {
        setLanguageState(stored)
      }
    })
  }, [])

  const setLanguage = (lang: Language) => {
    setLanguageState(lang)
    AsyncStorage.setItem(STORAGE_KEY, lang).catch(() => {})
  }

  const t = (key: string, fallback?: string) => {
    const dict = translations[language] || translations.ru
    return dict[key] || fallback || key
  }

  const value = useMemo(() => ({ language, setLanguage, t }), [language])

  return <LanguageContext.Provider value={value}>{children}</LanguageContext.Provider>
}

export const useTranslation = () => {
  const ctx = useContext(LanguageContext)
  if (!ctx) throw new Error('useTranslation must be used within LanguageProvider')
  return ctx
}

export const availableLanguages: { code: Language; label: string }[] = [
  { code: 'ru', label: translations.ru['settings.language.ru'] },
  { code: 'uz', label: translations.uz['settings.language.uz'] },
]
